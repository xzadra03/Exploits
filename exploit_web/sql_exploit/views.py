from django.http import QueryDict
from django.shortcuts import render
from django.views.generic import ListView, CreateView
from .models import MyUser
import re

class IntroView(ListView):
    model = MyUser
    template_name = 'index.html'
    searched_username = " "
    searched_password = " "
    query =  MyUser.objects.raw("SELECT * FROM sql_exploit_myuser")
    
    #this function returns match with required input
    def results(request):
        IntroView.searched_username = request.GET.get('search_text')
        
        #testing redos - yes it works: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa! should be enough
        #if re.match(r'^(([a-z])+.)+[A-Z]([a-z])+$', str(IntroView.searched_username)):
        #    pass
        #else:
        #    return render(request, 'index.html', {'data': IntroView.query})
        
        IntroView.searched_password = request.GET.get('search_pass')
        if IntroView.searched_username == "" and IntroView.searched_password == "":
            IntroView.query =  MyUser.objects.raw("SELECT * FROM sql_exploit_myuser")
        else:
            query_string = "SELECT * FROM sql_exploit_myuser WHERE username = '%s' AND password = '%s'" % (IntroView.searched_username, IntroView.searched_password)
            IntroView.query = MyUser.objects.raw(query_string)
        print(IntroView.query)
        return render(request, 'index.html', {'data': IntroView.query})
    
class AddUserView(CreateView):
    model = MyUser
    template_name = 'add_user.html'
    fields = '__all__'